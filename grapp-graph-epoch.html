 
<!--
Copyright (c) 2014-2015 Dirk Grappendorf, www.grappendorf.net. All rights reserved.
This code may only be used under the MIT style license found in the file LICENSE.txt.

Element: grapp-graph-epoch
Version: 0.0.5
Description: A web component that displays Epoch graphs
-->


<link href="../polymer/polymer.html" rel="import">
<link href="grapp-graph-epoch-series.html" rel="import">

<polymer-element name="grapp-graph-epoch" attributes="type axis theme width height">

  <template>

    <link rel="stylesheet" type="text/css" href="../epoch/epoch.min.css">

    <div class="epoch-theme-{{theme}}">
      <div id="graph" class="epoch category10"></div>
    </div>

  </template>

  <script src="../d3/d3.min.js"></script>
  <script src="../epoch/epoch.min.js"></script>

<script type="text/javascript">(function() {
  var slice = [].slice;

  Polymer('grapp-graph-epoch', {
    created: function() {
      this.axis = [];
      return this.theme = 'default';
    },
    domReady: function() {
      var s;
      this.data = (function() {
        var i, len, ref, results;
        ref = this.querySelectorAll('grapp-graph-epoch-series');
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          s = ref[i];
          results.push(this.createData(s));
        }
        return results;
      }).call(this);
      return this.draw();
    },
    createData: function(series) {
      return {
        label: series.label,
        values: series.data
      };
    },
    axisChanged: function() {
      if (this.graph) {
        return this.graph.option('axis', this.axis);
      }
    },
    draw: function() {
      var options;
      this.$.graph.innerHTML = '';
      options = {
        el: this.$.graph,
        data: this.data,
        axes: this.axis,
        width: this.width,
        height: this.height
      };
      this.graph = new Epoch._typeMap[this.type](options);
      return this.graph.draw();
    },
    push: function() {
      var args, d;
      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
      if (typeof args[0] === 'number') {
        return this.graph.push([
          {
            time: args[0],
            y: args[1]
          }
        ]);
      } else {
        return this.graph.push((function() {
          var i, len, results;
          results = [];
          for (i = 0, len = args.length; i < len; i++) {
            d = args[i];
            results.push({
              time: d[0],
              y: d[1]
            });
          }
          return results;
        })());
      }
    },
    clear: function() {
      var i, len, ref, series;
      ref = this.data;
      for (i = 0, len = ref.length; i < len; i++) {
        series = ref[i];
        series.values = [
          {
            time: 0,
            y: 0
          }
        ];
      }
      return this.draw();
    }
  });

}).call(this);
</script>

</polymer-element>
